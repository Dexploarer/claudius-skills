{
  "name": "database-migration-safety",
  "event": "user-prompt-submit",
  "description": "Ensures safe database migrations with backups and rollback plans",
  "enabled": true,
  "prompt": "Before executing database migration commands, ensure safety:\n\n**Detect Migration Commands:**\n- `npm run migrate`\n- `rails db:migrate`\n- `alembic upgrade head`\n- `prisma migrate deploy`\n- `flyway migrate`\n- Direct SQL ALTER/DROP statements\n\n**Migration Safety Protocol:**\n\n```\nüóÑÔ∏è  DATABASE MIGRATION DETECTED\n\nMigration: [migration-name]\nDatabase: [database-name]\nEnvironment: [environment]\n\n‚ö†Ô∏è  REQUIRED BEFORE MIGRATION\n\n1. Backup Status:\n   [ ] Full backup created?\n   [ ] Backup tested/verified?\n   [ ] Backup location: _____\n   [ ] Estimated restore time: _____\n\n2. Migration Analysis:\n   [ ] Migration reviewed?\n   [ ] Breaking changes identified?\n   [ ] Downtime required: [yes/no]\n   [ ] Estimated duration: _____\n\n3. Rollback Plan:\n   [ ] Down migration exists?\n   [ ] Rollback tested?\n   [ ] Data loss acceptable? [yes/no]\n   [ ] Rollback script ready?\n\n4. Testing:\n   [ ] Tested on staging?\n   [ ] Same data volume as prod?\n   [ ] Performance impact measured?\n   [ ] No locking issues?\n\n5. Risk Assessment:\n   Migration Type: [schema change/data migration/index]\n   Risk Level: [LOW/MEDIUM/HIGH/CRITICAL]\n\n   High-risk operations:\n   ‚Ä¢ DROP TABLE/COLUMN\n   ‚Ä¢ ALTER TABLE on large tables\n   ‚Ä¢ Adding NOT NULL without default\n   ‚Ä¢ Changing column types\n   ‚Ä¢ Renaming columns/tables\n\n6. Production Safety:\n   [ ] Maintenance window scheduled?\n   [ ] Team on standby?\n   [ ] Monitoring ready?\n   [ ] Alerts configured?\n\n---\n\nFor HIGH/CRITICAL migrations:\n\n1. Create backup:\n   [Provide exact backup command]\n\n2. Test rollback:\n   [Provide rollback steps]\n\n3. Run migration with monitoring:\n   [Migration command]\n\n4. Verify data integrity:\n   [Verification queries]\n\nProceed with migration? (yes/no)\n\nIf yes, please confirm database name: _____\n```"
}
