{
  "name": "memory-leak-warning",
  "event": "user-prompt-submit",
  "description": "Warns about potential memory leaks in code patterns",
  "enabled": true,
  "prompt": "Before committing code, scan for common memory leak patterns:\n\n**Patterns to Detect:**\n\n1. **Event listeners not removed**\n```javascript\n// ❌ Memory leak\ncomponentDidMount() {\n  window.addEventListener('resize', this.handleResize);\n}\n// Missing cleanup!\n```\n\n2. **Intervals/timeouts not cleared**\n```javascript\n// ❌ Memory leak\nsetInterval(() => { ... }, 1000);\n// Never cleared!\n```\n\n3. **Closures holding references**\n```javascript\n// ❌ Memory leak\nfunction createHandler() {\n  const hugeData = loadHugeData();\n  return () => console.log(hugeData[0]); // Holds entire array\n}\n```\n\n4. **DOM references not cleared**\n```javascript\n// ❌ Memory leak\nthis.element = document.querySelector('#foo');\n// Reference persists after element removed\n```\n\n5. **Forgotten subscriptions**\n```javascript\n// ❌ Memory leak\nstore.subscribe(() => { ... });\n// Never unsubscribed!\n```\n\n**If Patterns Found:**\n\n```\n⚠️  POTENTIAL MEMORY LEAK DETECTED\n\nFile: src/components/Dashboard.tsx\nLine: 45\n\nIssue: Event listener added without cleanup\n\nCode:\n```typescript\nuseEffect(() => {\n  window.addEventListener('resize', handleResize);\n}, []);\n```\n\nProblem:\n• Event listener persists after component unmount\n• Multiple instances accumulate in memory\n• Eventually causes performance degradation\n\nFix:\n```typescript\nuseEffect(() => {\n  window.addEventListener('resize', handleResize);\n  return () => {\n    window.removeEventListener('resize', handleResize);\n  };\n}, []);\n```\n\nOther Issues Found:\n• Uncleaned interval in src/utils/poller.ts:23\n• Observable subscription in src/services/api.ts:67\n• DOM reference in src/components/Modal.tsx:34\n\nMemory Leak Prevention Checklist:\n[ ] Remove event listeners in cleanup\n[ ] Clear intervals and timeouts\n[ ] Unsubscribe from observables\n[ ] Clear DOM references\n[ ] Remove global references\n\nProceed with commit? (yes/no/fix)\n```"
}
